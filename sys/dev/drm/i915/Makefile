# Note: none of the selftests are activated because of duplicate names

KMOD	= i915

.PATH:	${.CURDIR} \
	${.CURDIR}/display \
	${.CURDIR}/gem \
	${.CURDIR}/gt \
	${.CURDIR}/gt/uc \
	${.CURDIR}/gvt

# core driver code
SRCS =	i915_drv.c \
	i915_irq.c \
	i915_memcpy.c \
	i915_mm.c \
	i915_params.c \
	i915_pci.c \
	i915_suspend.c \
	i915_syncmap.c \
	i915_sw_fence.c \
	i915_sysfs.c \
	intel_csr.c \
	intel_device_info.c \
	intel_pm.c \
	intel_runtime_pm.c

# core library code
SRCS +=	dma_resv_utils.c	

# CONFIG_DEBUG_FS
# SRCS += i915_debugfs.c intel_pipe_crc.c

# GEM code
SRCS +=	i915_cmd_parser.c \
	i915_gem_evict.c \
	i915_gem_gtt.c \
	i915_gem.c \
	i915_vma.c \
	intel_breadcrumbs.c \
	intel_engine_cs.c \
	intel_hangcheck.c \
	intel_lrc.c \
	intel_mocs.c \
	intel_ringbuffer.c \
	intel_uncore.c \
	i915_gem_batch_pool.c \
	i915_gem_clflush.c \
	i915_gem_context.c \
	i915_gem_create.c \
	i915_gem_dmabuf.c \
	i915_gem_domain.c \
	i915_gem_execbuffer.c \
	i915_gem_fence_reg.c \
	i915_gem_internal.c \
	i915_gem_object.c \
	i915_gem_render_state.c \
	i915_gem_request.c \
	i915_gem_shrinker.c \
	i915_gem_stolen.c \
	i915_gem_tiling.c \
	i915_gem_timeline.c \
	i915_gem_userptr.c \
	i915_gem_busy.c \
	i915_gem_pages.c \
	i915_gem_phys.c \
	i915_gem_pm.c \
	i915_gem_region.c \
	i915_gem_shmem.c \
	i915_gem_throttle.c \
	i915_gem_ttm.c \
	i915_gem_wait.c \
	i915_gemfs.c

# general-purpose microcontroller (GuC) support
SRCS += intel_uc.c \
	intel_uc_fw.c \
	intel_guc.c \
	intel_guc_ct.c \
	intel_guc_log.c \
	intel_guc_fw.c \
	intel_huc.c \
	i915_guc_submission.c

SRCS += \
	i915_active.c \
	i915_buddy.c \
	i915_config.c \
	i915_debugfs.c \
	i915_debugfs_params.c \
	i915_gem_ww.c \
	i915_getparam.c \
	i915_gpu_error.c \
	i915_ioc32.c \
	i915_mitigations.c \
	i915_module.c \
	i915_pmu.c \
	i915_query.c \
	i915_request.c \
	i915_scatterlist.c \
	i915_scheduler.c \
	i915_sw_fence_work.c \
	i915_switcheroo.c \
	i915_ttm_buddy_manager.c \
	i915_user_extensions.c \
	i915_utils.c \
	intel_dram.c \
	intel_memory_region.c \
	intel_pch.c \
	intel_region_ttm.c \
	intel_step.c \
	intel_stolen.c \
	intel_wakeref.c \
	intel_wopcm.c \
	vlv_suspend.c \
	i915_ioc32.c

# gt
SRCS += \
	debugfs_engines.c \
	debugfs_gt.c \
	debugfs_gt_pm.c \
	gen2_engine_cs.c \
	gen6_engine_cs.c \
	gen6_ppgtt.c \
	gen7_renderclear.c \
	gen8_engine_cs.c \
	gen8_ppgtt.c \
	hsw_clear_kernel.c \
	intel_context.c \
	intel_context_sseu.c \
	intel_engine_heartbeat.c \
	intel_engine_pm.c \
	intel_engine_user.c \
	intel_execlists_submission.c \
	intel_ggtt.c \
	intel_ggtt_fencing.c \
	intel_gt.c \
	intel_gt_buffer_pool.c \
	intel_gt_clock_utils.c \
	intel_gt_irq.c \
	intel_gt_pm.c \
	intel_gt_pm_irq.c \
	intel_gt_requests.c \
	intel_gtt.c \
	intel_llc.c \
	intel_migrate.c \
	intel_ppgtt.c \
	intel_rc6.c \
	intel_region_lmem.c \
	intel_renderstate.c \
	intel_reset.c \
	intel_ring.c \
	intel_ring_submission.c \
	intel_rps.c \
	intel_sseu.c \
	intel_sseu_debugfs.c \
	intel_timeline.c \
	intel_workarounds.c \
	ivb_clear_kernel.c \
	mock_engine.c \
	selftest_engine_heartbeat.c \
	selftest_execlists.c \
	selftest_gt_pm.c \
	selftest_hangcheck.c \
	selftest_llc.c \
	selftest_lrc.c \
	selftest_migrate.c \
	selftest_mocs.c \
	selftest_rc6.c \
	selftest_reset.c \
	selftest_ring_submission.c \
	selftest_rps.c \
	selftest_slpc.c \
	selftest_timeline.c \
	selftest_workarounds.c \
	shmem_utils.c \
	st_shmem_utils.c \
	sysfs_engines.c \
	agp_intel_gtt.c

# gt/uc
SRCS += \
	intel_guc_debugfs.c \
	intel_guc_log_debugfs.c \
	intel_guc_rc.c \
	intel_guc_slpc.c \
	intel_guc_submission.c \
	intel_huc_debugfs.c \
	intel_huc_fw.c \
	intel_uc_debugfs.c \
	intel_guc_ads.c

# gvt
SRCS += \
	aperture_gm.c \
	cfg_space.c \
	cmd_parser.c \
	debugfs.c \
	display.c \
	dmabuf.c \
	edid.c \
	execlist.c \
	fb_decoder.c \
	firmware.c \
	gtt.c \
	gvt.c \
	handlers.c \
	interrupt.c \
	kvmgt.c \
	mmio.c \
	mmio_context.c \
	opregion.c \
	page_track.c \
	sched_policy.c \
	scheduler.c \
	trace_points.c \
	vgpu.c

# autogenerated null render state
SRCS +=	gen6_renderstate.c \
	gen7_renderstate.c \
	gen8_renderstate.c \
	gen9_renderstate.c

# openbsd modesetting

SRCS += \
	intel_bw.c \
	intel_combo_phy.c \
	intel_connector.c \
	intel_crtc.c \
	intel_cursor.c \
	intel_ddi_buf_trans.c \
	intel_display_debugfs.c \
	intel_display_power.c \
	intel_dmc.c \
	intel_dp_aux.c \
	intel_dp_hdcp.c \
	intel_dpll.c \
	intel_dpt.c \
	intel_drrs.c \
	intel_dsb.c \
	intel_fb.c \
	intel_fdi.c \
	intel_global_state.c \
	intel_gmbus.c \
	intel_hdcp.c \
	intel_pipe_crc.c \
	intel_pps.c \
	intel_qp_tables.c \
	intel_quirks.c \
	intel_snps_phy.c \
	intel_tc.c \
	intel_vdsc.c \
	intel_vga.c \
	intel_vrr.c \
	skl_scaler.c \
	skl_universal_plane.c \
	vlv_dsi.c \
	vlv_dsi_pll.c \
	intel_backlight.c

# modesetting core code
SRCS += \
	g4x_dp.c \
	g4x_hdmi.c \
	i9xx_plane.c \
	icl_dsi.c \
	intel_audio.c \
	intel_atomic.c \
	intel_atomic_plane.c \
	intel_acpi.c \
	intel_bios.c \
	intel_cdclk.c \
	intel_color.c \
	intel_display.c \
	intel_dpio_phy.c \
	intel_dpll_mgr.c \
	intel_fbc.c \
	intel_fifo_underrun.c \
	intel_frontbuffer.c \
	intel_hotplug.c \
	intel_fbdev.c \
	intel_modes.c \
	intel_opregion.c \
	intel_overlay.c \
	intel_psr.c \
	intel_sideband.c \
	intel_sprite.c

# modesetting output/encoder code
SRCS += \
	dvo_ch7017.c \
	dvo_ch7xxx.c \
	dvo_ivch.c \
	dvo_ns2501.c \
	dvo_sil164.c \
	dvo_tfp410.c \
	intel_crt.c \
	intel_ddi.c \
	intel_dp.c \
	intel_dp_aux_backlight.c \
	intel_dp_link_training.c \
	intel_dp_mst.c \
	intel_dsi.c \
	intel_dsi_dcs_backlight.c \
	intel_dsi_pll.c \
	intel_dsi_vbt.c \
	intel_dvo.c \
	intel_hdmi.c \
	intel_i2c.c \
	intel_lspcon.c \
	intel_lvds.c \
	intel_panel.c \
	intel_sdvo.c \
	intel_tv.c

# Post-mortem debug and GPU hang state capture
#i915-$(CONFIG_DRM_I915_CAPTURE_ERROR) += i915_gpu_error.o
#i915-$(CONFIG_DRM_I915_SELFTEST) += \
	selftests/i915_random.o \
	selftests/i915_selftest.o

# virtual gpu code
SRCS += i915_vgpu.c

# perf code
SRCS += i915_perf.c \
	i915_oa_hsw.c

# CONFIG_DRM_I915_GVT
#SRCS += intel_gvt.c

# LPE Audio for VLV and CHT
SRCS += intel_lpe_audio.c

SRCS += \
	opt_acpi.h \
	opt_ddb.h \
	opt_drm.h \
	acpi_if.h \
	bus_if.h \
	device_if.h \
	pci_if.h

KCFLAGS+= -I${SYSDIR}/dev/drm/include
KCFLAGS+= -I${SYSDIR}/dev/drm/include/drm
KCFLAGS+= -I${SYSDIR}/dev/drm/include/uapi
KCFLAGS+= -I${SYSDIR}/dev/drm/include/uapi/drm
KCFLAGS+= -I${SYSDIR}/contrib/dev/acpica/source/include
KCFLAGS+= -I${SYSDIR}/dev/drm/i915/
KCFLAGS+= -I${SYSDIR}/dev/drm/i915/display
KCFLAGS+= -I${SYSDIR}/dev/drm/i915/gem
KCFLAGS+= -I${SYSDIR}/dev/drm/i915/gt
KCFLAGS+= -I${SYSDIR}/dev/drm/i915/gt/uc
KCFLAGS+= -I${SYSDIR}/dev/drm/i915/gt/uc/abi
KCFLAGS+= -I${SYSDIR}/dev/drm/i915/gvt
KCFLAGS+= -I${SYSDIR}/dev/drm/scheduler
KCFLAGS+= -include ${SYSDIR}/dev/drm/kconfig.h
KCFLAGS+= -DKBUILD_MODNAME=\"${KMOD}\"

.include <bsd.kmod.mk>
